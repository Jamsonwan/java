# 计算机网络

## HTTPS

### 为什么需要加密

​	 http 的内容是明文传输的，明文数据会经过中间代理服务器、路由器、wifi热点、通信服务运营商等多个物理节点。如信息在传递过程中被劫持，传输的内容就完全暴露了。

### 什么是对称加密

* 用一个密钥，可以加密一段信息，也可以对加密后的信息进行解密。（钥匙）
* 如果通信双方都各自持有同一个密钥，且没有别人知道，这两方的通信安全当然是可以被保证的（除非密钥被破解）
* 如何保证 密钥怎么让传输的双方知晓，同时不被别人知道？---》非对称加密

### 非对称加密

* 两把密钥（公钥和私钥）。公钥加密的内容必须使用私钥才能解开，同样，私钥加密的内容只有公钥才能解开。
* 服务器先把公钥以明文的方式传输给浏览器，之后浏览器向服务器传输数据前都用公钥加密好再传。只保证浏览器到服务器的传输数据的安全性。
* 非对称加密算法非常耗时，而对称加密快很多。



### 对称加密和非对称加密组合

1. 某网站拥有用于非对称加密的公钥A、私钥A’。
2. 浏览器向网站服务器请求，服务器把公钥A明文给传输浏览器。
3. 浏览器**随机生成一个用于对称加密的密钥X**，用公钥A加密后传给服务器。
4. 服务器拿到后用私钥A’解密得到密钥X。
5. 这样双方就都拥有密钥X了，且别人无法知道它。之后双方所有数据都通过密钥X加密解密即可。

### 中间人攻击

1. 某网站有用于非对称加密的公钥A、私钥A’。
2. 浏览器向网站服务器请求，服务器把公钥A明文给传输浏览器。
3. **中间人劫持到公钥A，保存下来，把数据包中的公钥A替换成自己伪造的公钥B（它当然也拥有公钥B对应的私钥B’）**。
4. 浏览器生成一个用于对称加密的密钥X，用**公钥B**（浏览器无法得知公钥被替换了）加密后传给服务器。
5. **中间人劫持后用私钥B’解密得到密钥X，再用公钥A加密后传给服务器**。
6. 服务器拿到后用私钥A’解密得到密钥X。

* 上述原因：浏览器无法确认受到的公钥是不是网站自己的。

### 数字证书

* CA机构颁发的标识证书
* 网站在使用HTTPS前，需要向**CA机构**申领一份**数字证书**，数字证书里含有证书持有者信息、公钥信息等。服务器把证书传输给浏览器，浏览器从证书里获取公钥就行了

### 如何放防止数字证书被篡改？

* 我们把证书原本的内容生成一份“签名”，比对证书内容和签名是否一致就能判别是否被篡改。这就是数字证书的“防伪技术”，这里的“签名”就叫`数字签名`：

* 数字签名的制定过程：
  * CA机构拥有非对称加密的私钥和公钥。
  * CA机构对证书明文数据T进行hash。
  * 对hash后的值用私钥加密，得到数字签名S。
* 浏览器验证过程
  * 拿到证书，得到明文T，签名S。
  * 用CA机构的公钥对S解密（由于是浏览器信任的机构，所以浏览器保有它的公钥。数字签名链），得到S’。
  * 用证书里指明的hash算法对明文T进行hash得到T’。
  * 显然通过以上步骤，T’应当等于S‘，除非明文或签名被篡改。所以此时比较S’是否等于T’，等于则表明证书可信。
* hash为了得到固定长度的信息，加快解密

### HTTPS数据传输流程

1. 浏览器将支持的加密算法信息发送给服务器
2. 服务器选择一套浏览器支持的加密算法，以证书的形式回发给浏览器
3. 浏览器验证证书的合法性，并结合证书公钥加密对称密钥C信息发送给服务器
4. 服务器使用私钥解密信息，验证哈希、用C加密响应信息回发浏览器
5. 浏览器用C密钥解密响应信息，并对消息进行验真，之后进行加密交互数据

## HTTP和HTTPS的区别

1. HTTPS需要到CA机构申请证书，HTTP不需要
2. HTTPS密文传输，HTTP明文传输
3. 连接方式不同，HTPPS的默认使用端口为443，而HTTP为80
4. HTTPS = HTTP + SSL（加密 + 认证 + 完整性保护 or TLS），较HTTP安全

## HTTP状态码

* 1xx：指示信息---表示请求已接收，继续处理
* 2xx：成功--表示请求已被成功接收、理解、接受
* 3xx：重定向--要完成请求必须进行更进一步的操作
* 4xx：客户端错误--请求有语法错误或请求无法实现
* 5xx：服务端错误--服务器未能实现合法的请求



